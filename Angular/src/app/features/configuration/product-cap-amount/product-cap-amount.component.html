
<div class="row mb-4">
  <div class="col">
    <h5 class="">Maximum Amount Per Stream</h5>
  </div>
</div>

<div class="card p-3" *ngIf="isDataReady" >
  <form [formGroup]="ProductCapForm">
    <div class="row mb-3">
      <div class="col-4">
        <label class="inputLabel">{{ 'Select Stream' | translate }}</label>
        <select class="form-control" formControlName="productId">
          <option value="" disabled>{{ 'Choose Stream' | translate }}</option>
          <option *ngFor="let product of productsList" [value]="product.productId">
            {{ product.productName }}
          </option>
        </select>
      </div>
    </div>
  </form>
</div>

<!-- Loading Message -->
<div class="loading-container" *ngIf="!isDataReady">
  <p>Loading data, please wait...</p>
</div>

<!-- Add/Edit Form -->
<div class="card p-3" *ngIf="formvisible" >
  <form [formGroup]="ProductCapForm" (ngSubmit)="onSubmit()">
    <div class="row mb-3 align-items-start">
      <input type="number" hidden class="form-control" formControlName="id" />

      <!--<div class="col-md-4">
        <label class="inputLabel">Activity<span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="activity" />
        <div class="text-danger"
             *ngIf="ProductCapForm.get('activity')?.touched && ProductCapForm.get('activity')?.hasError('required')">
          Activity  is required.
    </div> 
      </div>-->

      <!--<div class="col-md-4">
        <label class="inputLabel">Max Cap Per Stream <span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="maxCapPerStream" />
        <div class="text-danger"
             *ngIf="ProductCapForm.get('maxCapPerStream')?.touched && ProductCapForm.get('maxCapPerStream')?.hasError('required')">
          Max Cap Per Stream  is required.
        </div>
        <div class="text-danger"
             *ngIf="ProductCapForm.get('maxCapPerStream')?.hasError('pattern') &&
              ProductCapForm.get('maxCapPerStream')?.value">
          Max Cap Per Stream must be a number.
        </div>-->
        <!--<div class="text-danger" *ngIf="ProductCapForm.errors?.['maxLessThanMin'] &&
      (ProductCapForm.get('maximumScore')?.touched || ProductCapForm.get('maximumScore')?.dirty)">
    Maximum Score must be greater than or equal to Minimum Score.
  </div>-->
      <!--</div>-->

      <!-- Product Cap -->
      <div class="col-md-4">
        <label class="inputLabel">Age Criteria<span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="age" />
        <div class="text-danger"
             *ngIf="ProductCapForm.get('age')?.touched && ProductCapForm.get('age')?.hasError('required')">
          Age is required.
        </div>
     
      </div>

      <!-- Custom validation message in one line -->
      <!--<div class="col-12 text-danger mt-2" *ngIf="showMinMaxError">
    Minimum Score must be less than or equal to Maximum Score.
  </div>-->

      <div class="col-md-4">
        <label class="inputLabel">Salary Criteria<span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="salary" />
        <div class="text-danger"
             *ngIf="ProductCapForm.get('salary')?.touched && ProductCapForm.get('salary')?.hasError('required')">
          Salary is required.
        </div>
      
      </div>
      <div class="col-md-4">
        <label class="inputLabel">Amount<span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="amount" />
        <div class="text-danger"
             *ngIf="ProductCapForm.get('amount')?.touched && ProductCapForm.get('amount')?.hasError('required')">
          Amount is required.
        </div>
        <div class="text-danger"
             *ngIf="ProductCapForm.get('amount')?.hasError('pattern') &&
        ProductCapForm.get('amount')?.value">
         Amount must be a number.
        </div>

      </div>
      <!--<input type="hidden" formControlName="productName" />-->
    </div>

    <!-- <div class="row mb-3">

    </div> -->
    <!-- Buttons -->
    <div class="text-end">
      <button class="addBtn btn-primary me-2"  [appUseractivity]="!isEditMode ? 'Add button clicked' : 'Update button clicked'"
              [componentName]="'ProductCapAmountComponent'"
              [actionType]="'FormSubmit'" type="submit" [disabled]="ProductCapForm.invalid">
        {{ isEditMode ? 'Update' : 'Add' }}
      </button>
      <button class="btn-secondary cancelBtn"appUseractivity="User Click on cancel button"
              [componentName]="'ProductCapAmountComponent'"
              [actionType]="'ButtonClick'" type="button" (click)="resetForm()"> Cancel</button>
    </div>
  </form>
</div>
<div  class="card p-3" *ngIf="ProductCapForm.get('productId')?.value" >

  <div class="mb-3 d-flex justify-content-start">
    <button mat-raised-button color="primary"appUseractivity="User Click on Add Stream Cap Amount button"
              [componentName]="'ProductCapAmountComponent'"
              [actionType]="'ButtonClick'" (click)="addProductCap()" matTooltip="Add Stream Cap Amount" *ngIf="hasPermission('Permissions.ProductCapAmount.Create')">
      <mat-icon>add</mat-icon> Add New
    </button>
  </div>
  <div #entityTable class="table-wrapper">
    <!-- Table if data exists -->
    <table class="bgColorWhite mat-elevation-z8" mat-table
           [dataSource]="selectedProductData">

      <!-- Optional ID column -->
      <!--<ng-container hidden matColumnDef="id">
    <th class="cellStyling" mat-header-cell *matHeaderCellDef>Id</th>
    <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.id }}</td>
  </ng-container>-->
      <ng-container matColumnDef="productName">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Stream Name</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.productName }}</td>
      </ng-container>

      <!--<ng-container matColumnDef="activity">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Activity</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.activity }}</td>
      </ng-container>-->

      <ng-container matColumnDef="maxCapPerStream">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Max Cap Per Stream</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.maxCapPerStream }}</td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Age Criteria</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.age }}</td>
      </ng-container>

      <ng-container matColumnDef="salary">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Salary Criteria</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.salary }}</td>
      </ng-container>
      <ng-container matColumnDef="amount">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Amount</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">{{ element.amount }}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th class="cellStyling" mat-header-cell *matHeaderCellDef>Actions</th>
        <td class="cellStyling" mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="editProductCapAmount(element)" matTooltip="Edit" *ngIf="hasPermission('Permissions.ProductCapAmount.Edit')">
            <mat-icon>edit</mat-icon>
          </button >
          <button mat-icon-button color="warn" (click)="deleteProductCapAmount(element)" matTooltip="Delete" *ngIf="hasPermission('Permissions.ProductCapAmount.Delete')">
            <mat-icon>delete</mat-icon>
          </button >
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="tableHeader"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="select-row"></tr>
    </table>
  </div>
  <!-- Message when no data -->
  <div *ngIf="selectedProductData.length === 0" class="text-center text-muted mt-3">
    <p>No Stream Cap Amount available for the selected Stream.</p>
  </div>
</div>
