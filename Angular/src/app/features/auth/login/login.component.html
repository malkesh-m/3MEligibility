<div class="viewport-container">
  <div class="login-container">

    <!-- LANGUAGE -->
    <mat-menu #languageMenu="matMenu">
      <button mat-menu-item (click)="changeLanguage('en')">EN</button>
      <button mat-menu-item (click)="changeLanguage('ar')">AR</button>
    </mat-menu>

    <button mat-icon-button
            [matMenuTriggerFor]="languageMenu"
            aria-label="Language"
            style="width:fit-content;margin-left:auto;">
      <mat-icon>language</mat-icon>
      <span class="lang-text">{{ currentLanguage.toUpperCase() }}</span>
    </button>

    <div class="login-wrapper">
      <mat-card class="card-wrap" appearance="outlined">

        <!-- LOGO -->
        <div class="logo-container">
          <!-- <img src="https://www.sdb.gov.sa/sdb/media/sdb/sdblogo-en.png"
               alt="SDB Logo"
               class="logo"> -->
        </div>

        <!-- TITLES -->
        <h2 class="fancy-title" *ngIf="!isForgetPassword && !isForceReset">
          {{ 'Login Form' | translate }}
        </h2>

        <h2 class="fancy-title" *ngIf="isForgetPassword && !isForceReset">
          {{ 'Forgot Password' | translate }}
        </h2>

        <h2 class="fancy-title" *ngIf="isForceReset">
          {{ 'Reset Password' | translate }}
        </h2>

        <!-- SUBTITLE -->
        <p class="fancy-subtitle" *ngIf="!isForgetPassword && !isForceReset">
          {{ 'Enter your username and password to access your account.' | translate }}
        </p>

        <p class="fancy-subtitle" *ngIf="isForgetPassword && !isForceReset">
          {{ 'Enter your email, and we’ll send a reset password link.' | translate }}
        </p>

        <p  class="fancy-subtitle text-danger"  *ngIf="isForceReset">
          {{ 'Your password has expired. Please create a new password.' | translate }}
        </p>

        <!-- LOGIN FORM -->
        <form fxLayout="column"
              *ngIf="!isForgetPassword && !isForceReset"
              [formGroup]="loginForm"
              (ngSubmit)="onSubmit()"
              class="example-form"
              autocomplete="off">

          <mat-form-field class="example-full-width">
            <mat-label>{{ 'Login ID' | translate }}</mat-label>
            <input matInput formControlName="loginId">
          </mat-form-field>

          <mat-form-field class="example-full-width">
            <mat-label>{{ 'Password' | translate }}</mat-label>
            <input matInput type="password" formControlName="password">
          </mat-form-field>

          <div class="btn-sumit">
            <button mat-flat-button color="primary" type="submit">
              {{ 'Sign In' | translate }}
            </button>
          </div>
        </form>

        <!-- FORGOT PASSWORD -->
        <form fxLayout="column"
              *ngIf="isForgetPassword && !isForceReset"
              [formGroup]="forgetForm"
              class="example-form">

          <mat-form-field class="example-full-width">
            <mat-label>{{ 'Email' | translate }}</mat-label>
            <input matInput type="email" formControlName="email">
          </mat-form-field>

          <div class="btn-sumit">
            <button mat-flat-button color="primary" (click)="forgetOnSubmit()">
              {{ 'Submit' | translate }}
            </button>
          </div>

          <div class="btn-sumit">
            <button mat-flat-button color="white" type="button" (click)="navigateToLogin()">
              {{ 'Back to Login' | translate }}
            </button>
          </div>
        </form>

        <!-- RESET PASSWORD (SAME DESIGN) -->
        <form fxLayout="column"
              *ngIf="isForceReset"
              [formGroup]="resetForm"
              (ngSubmit)="resetOnSubmit()"
              class="example-form">

          <mat-form-field class="example-full-width">
            <mat-label>{{ 'New Password' | translate }}</mat-label>
            <input matInput type="password" formControlName="newPassword">

            <!--<div class="password-rules"
    *ngIf="resetForm.get('newPassword')?.touched">-->
            <!--<div [class.invalid]="resetForm.get('newPassword')?.hasError('minlength')">
      • At least 8 characters
    </div>-->
            <!--</div>-->
            <mat-error *ngIf="resetForm.get('newPassword')?.hasError('sameAsCurrent')">
              New password cannot be the same as current password
            </mat-error>
            <div class="password-rules-container"
                 *ngIf="resetForm.get('newPassword')?.touched && resetForm.get('newPassword')?.value">







              <div class="password-rules-list">
                <!-- Length requirement -->
                <div class="password-rule"
                     [class.valid]="!resetForm.get('newPassword')?.hasError('minlength')"
                     [class.invalid]="resetForm.get('newPassword')?.hasError('minlength')">
                  <div class="rule-icon"></div>
                  <span class="rule-text">At least 8 characters long</span>
                </div>

                <!-- Pattern requirements - combined in one rule as per your original -->
                <div class="password-rule"
                     [class.valid]="!resetForm.get('newPassword')?.hasError('pattern')"
                     [class.invalid]="resetForm.get('newPassword')?.hasError('pattern')">
                  <div class="rule-icon"></div>
                  <span class="rule-text">Contains uppercase, lowercase, number & special character</span>
                </div>
              </div>

            </div>
          </mat-form-field>



          <mat-form-field class="example-full-width">
            <mat-label>{{ 'Confirm Password' | translate }}</mat-label>
            <input matInput type="password" formControlName="confirmPassword">
            <mat-error *ngIf="resetForm.get('confirmPassword')?.hasError('mismatch')">
              Passwords do not match
            </mat-error>
          </mat-form-field>



          <div class="btn-sumit">
            <button mat-flat-button color="primary" type="submit"  [disabled]="!canSubmitReset()">

              {{ 'Submit' | translate }}
            </button>
          </div>
        </form>

        <!-- FORGOT LINK -->
        <a class="forget-link"
           *ngIf="!isForgetPassword && !isForceReset"
           (click)="forgetPassword()">
          {{ 'Forgot Password' | translate }}?
        </a>

      </mat-card>
    </div>
  </div>

  <!-- RIGHT COVER -->
  <div class="cover">
    <div class="cover-content">
      <h1 class="cover-title">{{ '3M Eligibility Backend' | translate }}</h1>
      <p class="cover-description">
        {{ 'An Eligibility System integrated with a Service Data Bus streamlines decision-making processes by integrating multiple data sources, applying configurable business rules, and delivering transparent results. It reduces complexity by decoupling core logic from underlying services and ensures quick updates to eligibility criteria without IT overhauls. This ultimately improves customer experience, operational efficiency, and compliance adherence' | translate }} 
      </p>
    </div>
  </div>
</div>
