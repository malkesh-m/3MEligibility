<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="me-auto">
        <h4 class="mb-0">{{ activeTabTitle | translate }}</h4>
    </div>
</div>

<div class="filter-bar">
    <div class="d-flex align-items-center gap-3">
        <div class="col-auto" *ngIf="activeTab === 'AssignedPermissions'">
            <label class="inputLabel d-block">{{ 'Assigned Permissions' | translate }}</label>
            <select #parameterSelect class="filter-select" [(ngModel)]="selectedRoleId" (change)="onSelect($event)">
                <option value="null" disabled [selected]="selectedRoleId === null">{{ 'Select' | translate }}</option>
                <option *ngFor="let param of records" [value]="param.roleId">
                    {{ param.roleName }}
                </option>
            </select>
            <div *ngIf="isSuperAdminSelected()" class="text-danger mt-1" style="font-size: 13px; line-height: 1.2;">
                {{ 'Super Admin permissions cannot be removed.' | translate }}</div>
        </div>

        <div class="search-box" *ngIf="activeTab === 'AvailablePermissions'">
            <mat-icon>search</mat-icon>
            <input type="text" class="filter-input" placeholder="{{ 'Search' | translate }}"
                (input)="applyFilter($event)" [(ngModel)]="searchTerm" />
        </div>
    </div>

    <div class="action-group">
        <button appUseractivity="User Click on Remove Permission button" [disabled]="isSuperAdminSelected()"
            [componentName]="'PermissionComponent'" [actionType]="'ButtonClick'" class="clickable-icon"
            (click)="deletePermission()" *ngIf="activeTab === 'AssignedPermissions'">
            <mat-icon matTooltip="{{ 'Remove Permission' | translate }}">delete</mat-icon>
        </button>

        <button appUseractivity="User Click on Add Permission button" [componentName]="'PermissionComponent'"
            [actionType]="'ButtonClick'" class="clickable-icon" (click)="addPermission()"
            *ngIf="activeTab === 'AvailablePermissions'">
            <mat-icon matTooltip="{{ 'Add Permission' | translate }}">add_circle_outline</mat-icon>
        </button>
    </div>
</div>

<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'AssignedPermissions'"
            (click)="switchTab('AssignedPermissions')">
            {{ 'Assigned Permissions' | translate }}
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'AvailablePermissions'"
            (click)="switchTab('AvailablePermissions')">
            {{ 'Available Permissions' | translate }}
        </a>
    </li>
</ul>

<!-- Assigned Permissions Table -->
<div *ngIf="activeTab === 'AssignedPermissions'" class="table-wrapper">
    <div *ngIf="permissionAssignedDataSource.data.length === 0" class="text-center text-muted">
        {{ 'No items to show...' | translate }}
    </div>
    <table mat-table [dataSource]="permissionAssignedDataSource" matSort
        *ngIf="permissionAssignedDataSource.data.length > 0">
        <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
                <!-- Optional header for checkbox -->
            </th>
            <td mat-cell *matCellDef="let entity">
                <mat-checkbox [(ngModel)]="entity.selected" (change)="onCheckboxChange(entity)">
                </mat-checkbox>
            </td>
        </ng-container>
        <ng-container matColumnDef="permissionAction">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'Name' | translate }} </th>
            <td mat-cell *matCellDef="let entity"> {{
                formatPermissionAction(entity.permissionAction) }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="combinedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: combinedColumns;"></tr>
    </table>
    <mat-paginator class="paginator" [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
</div>

<!-- Available Permissions Table -->
<div *ngIf="activeTab === 'AvailablePermissions'" class="table-wrapper">
    <div *ngIf="permissionUnassignedDataSource.data.length === 0" class="text-center text-muted">
        {{ 'No items to show...' | translate }}
    </div>
    <table mat-table [dataSource]="permissionUnassignedDataSource" matSort
        *ngIf="permissionUnassignedDataSource.data.length > 0">
        <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
                <!-- Optional header for checkbox -->
            </th>
            <td mat-cell *matCellDef="let entity">
                <mat-checkbox [(ngModel)]="entity.selected" (change)="onCheckboxChange(entity)">
                </mat-checkbox>
            </td>
        </ng-container>

        <ng-container matColumnDef="permissionAction">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'Name' | translate }} </th>
            <td mat-cell *matCellDef="let entity"> {{
                formatPermissionAction(entity.permissionAction) }} </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="combinedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: combinedColumns;" class="select-row"></tr>
    </table>
    <mat-paginator class="paginator" [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
</div>
<app-spinner [isLoading]="isLoading || isDownloading || isUploading" [message]="message"></app-spinner>