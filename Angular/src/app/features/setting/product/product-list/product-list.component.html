<div class="product-list-container">
    <!-- Add/Edit Form (Edit Panel) -->
    <div *ngIf="formVisible" class="card p-3 mb-3">
        <h5 class="mb-3">
            <span *ngIf="isInsertNewRecord">{{ 'Add New' | translate }} </span>
            <span *ngIf="!isInsertNewRecord">{{ 'Edit' | translate }} </span>
            {{ (currentTab === 'Category' ? 'Category' : (currentTab === 'Info' ? 'Product' : 'Details')) |
            translate }}
        </h5>

        <app-spinner [isLoading]="isLoading" [isLocal]="true" [message]="'Processing...'"></app-spinner>

        <div [ngSwitch]="currentTab">
            <!-- CATEGORY FORM -->
            <div *ngSwitchCase="'Category'">
                <form [formGroup]="formData" (ngSubmit)="formRecord()">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="inputLabel" for="categoryName">{{ 'Name' | translate }} <span
                                    class="text-danger">*</span></label>
                            <input class="form-control" formControlName="categoryName" id="categoryName"
                                (input)="sanitizeCode($event)" maxlength="50" required>
                            <div *ngIf="formData.get('categoryName')?.invalid && formData.get('categoryName')?.touched"
                                class="text-danger mt-1">
                                {{ 'Category Name is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="inputLabel" for="catDescription">{{ 'Description' | translate
                                }}</label>
                            <input class="form-control" formControlName="catDescription" id="catDescription"
                                (input)="sanitizeCode($event)" maxlength="250">
                        </div>
                    </div>
                    <div class="d-flex flex-wrap align-items-center justify-content-end mt-4 mb-3">
                        <button mat-flat-button
                            [appUseractivity]="isInsertNewRecord ? 'Add button clicked' : 'Update button clicked'"
                            [componentName]="'ProductListComponent'" [actionType]="'FormSubmit'" type="submit"
                            class="addBtn me-2" [disabled]="formData.invalid">
                            {{ isInsertNewRecord ? ('Add' | translate) : ('Update' | translate) }}
                        </button>
                        <button mat-raised-button type="button" class="cancelBtn" (click)="cancelEvent()">
                            {{ 'Cancel' | translate }}
                        </button>
                    </div>
                </form>
            </div>

            <!-- PRODUCT INFO FORM -->
            <div *ngSwitchCase="'Info'">
                <form [formGroup]="formData" (ngSubmit)="onSubmit()">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="inputLabel" for="code">{{ 'Code' | translate }} <span
                                    class="text-danger">*</span></label>
                            <input class="form-control" formControlName="code" id="code" (input)="sanitizeCode($event)"
                                maxlength="10" required>
                            <div *ngIf="formData.get('code')?.invalid && formData.get('code')?.touched"
                                class="text-danger mt-1">
                                {{ 'Code is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="inputLabel" for="productName">{{ 'Product Name' | translate }} <span
                                    class="text-danger">*</span></label>
                            <input class="form-control" formControlName="productName" id="productName"
                                (input)="sanitizeCode($event)" maxlength="50" required>
                            <div *ngIf="formData.get('productName')?.invalid && formData.get('productName')?.touched"
                                class="text-danger mt-1">
                                {{ 'Product Name is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="inputLabel" for="productCategory">{{ 'Category' | translate }} <span
                                    class="text-danger">*</span></label>
                            <select class="form-control" formControlName="productCategory" id="productCategory"
                                (change)="bindEntityId($event,'Info')" required>
                                <option value="" disabled selected>{{ 'Select Category' | translate }}</option>
                                <option *ngFor="let category of categoryList" [value]="category.categoryId">
                                    {{ category.categoryName }}
                                </option>
                            </select>
                            <div *ngIf="formData.get('productCategory')?.invalid && formData.get('productCategory')?.touched"
                                class="text-danger mt-1">
                                {{ 'Category is required' | translate }}
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="inputLabel d-block mb-2">{{ 'Product Image' | translate }}</label>
                            <div class="upload-zone-compact" [class.dragging]="isDragging" (click)="fileInput.click()"
                                (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
                                (drop)="onDrop($event)">
                                <input type="file" #fileInput class="file-input" (change)="onFileSelect($event)"
                                    accept="image/jpeg,image/jpg,image/png,image/gif,image/bmp,image/webp" />

                                <div *ngIf="!imagePreview" class="upload-placeholder-compact">
                                    <mat-icon>add_photo_alternate</mat-icon>
                                    <span class="upload-text-compact">{{ 'Click to upload image' | translate
                                        }}</span>
                                    <span class="upload-hint-compact">{{ 'JPG, PNG (Max 5MB)' | translate
                                        }}</span>
                                </div>

                                <div *ngIf="imagePreview" class="image-preview-compact">
                                    <img [src]="imagePreview" alt="Product Image" class="preview-img-compact" />
                                    <button type="button" class="remove-btn-compact"
                                        (click)="$event.stopPropagation(); removeImage()">
                                        <mat-icon style="font-size: 18px;">close</mat-icon>
                                    </button>
                                </div>

                                <div *ngIf="isImageUploading || isImageFetching" class="upload-loading-compact">
                                    <div class="upload-spinner-compact"></div>
                                    <span class="upload-loading-text-compact">
                                        {{ isImageUploading ? ('Uploading...' | translate) : ('Loading...' |
                                        translate) }}
                                    </span>
                                </div>
                            </div>
                            <small class="text-muted d-block mt-1" *ngIf="selectedImageFile">
                                {{ selectedImageFile.name }} ({{ (selectedImageFile.size / 1024).toFixed(1) }}
                                KB)
                            </small>
                        </div>
                        <div class="col-md-6">
                            <label class="inputLabel" for="description">{{ 'Description' | translate }}</label>
                            <textarea class="form-control" formControlName="description" id="description" maxlength="50"
                                rows="4"></textarea>
                            <small class="text-muted d-block mt-1 text-end">{{
                                formData.get('description')?.value?.length || 0 }}/50</small>
                        </div>
                    </div>

                    <div class="d-flex flex-wrap align-items-center justify-content-end mt-4 mb-3">
                        <button mat-flat-button
                            [appUseractivity]="isInsertNewRecord ? 'Add button clicked' : 'Update button clicked'"
                            [componentName]="'ProductListComponent'" [actionType]="'FormSubmit'" type="submit"
                            class="addBtn me-2" [disabled]="formData.invalid">
                            {{ isInsertNewRecord ? ('Add' | translate) : ('Update' | translate) }}
                        </button>
                        <button mat-raised-button type="button" class="cancelBtn" (click)="cancelEvent()">
                            {{ 'Cancel' | translate }}
                        </button>
                    </div>
                </form>
            </div>

            <!-- PRODUCT DETAILS FORM -->
            <div *ngSwitchCase="'Details'">
                <form [formGroup]="formData" (ngSubmit)="detailsFormSubmit()">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="inputLabel" for="product">{{ 'Product' | translate }} <span
                                    class="text-danger">*</span></label>
                            <select class="form-control" formControlName="product" id="product"
                                (change)="onSelectProductItem($event)" required>
                                <option value="" disabled selected>{{ 'Select Product' | translate }}</option>
                                <option *ngFor="let products of ProductListDetails" [value]="products.productId">
                                    {{ products.productName }}
                                </option>
                            </select>
                            <div *ngIf="formData.get('product')?.invalid && formData.get('product')?.touched"
                                class="text-danger mt-1">
                                {{ 'Product is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="inputLabel" for="parameter">{{ 'Parameter' | translate }} <span
                                    class="text-danger">*</span></label>
                            <select class="form-control" formControlName="parameter" id="parameter"
                                (change)="onSelectParameterItem($event)" required>
                                <option value="" disabled selected>{{ 'Select Parameter' | translate }}</option>
                                <option *ngFor="let paramters of parametersList" [value]="paramters.parameterId">
                                    {{ paramters.parameterName }}
                                </option>
                            </select>
                            <div *ngIf="formData.get('parameter')?.invalid && formData.get('parameter')?.touched"
                                class="text-danger mt-1">
                                {{ 'Parameter is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="inputLabel" for="parameterValue">{{ 'Parameter Value' | translate
                                }}</label>
                            <select class="form-control" formControlName="parameterValue" id="parameterValue">
                                <option value="" disabled selected>{{ 'Select Value' | translate }}</option>
                                <option *ngFor="let paramValue of parametersValueList" [value]="paramValue">
                                    {{ paramValue }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="inputLabel" for="displayOrder">{{ 'Display Order' | translate }} <span
                                    class="text-danger">*</span></label>
                            <input type="number" class="form-control" formControlName="displayOrder" id="displayOrder"
                                required>
                            <div *ngIf="formData.get('displayOrder')?.invalid && formData.get('displayOrder')?.touched"
                                class="text-danger mt-1">
                                {{ 'Display Order is required' | translate }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="inputLabel" for="isrequired">{{ 'Required Field' | translate }} <span
                                    class="text-danger">*</span></label>
                            <select class="form-control" formControlName="isrequired" id="isrequired" required>
                                <option *ngFor="let isrequired of requiredAry" [value]="isrequired.value">
                                    {{ isrequired.label }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="d-flex flex-wrap align-items-center justify-content-end mt-4 mb-3">
                        <button mat-flat-button
                            [appUseractivity]="isInsertNewRecord ? 'Add button clicked' : 'Update button clicked'"
                            [componentName]="'ProductListComponent'" [actionType]="'FormSubmit'" type="submit"
                            class="addBtn me-2" [disabled]="formData.invalid">
                            {{ isInsertNewRecord ? ('Add' | translate) : ('Update' | translate) }}
                        </button>
                        <button mat-raised-button type="button" class="cancelBtn" (click)="cancelEvent()">
                            {{ 'Cancel' | translate }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Table Section -->
    <div class="table-container">
        <app-table #tableChild [cols]="columnsDisplayAry" [checkedSelectedId]="deleteKeyForMultiple"
            [displayedColumns]="columnsDisplayAry" [header]="headerDisplayAry" [rows]="rows"
            (actionEvent)="tableRowAction($event)" [editPermissionId]="editPermissionId"
            [deletePermissionId]="deletePermissionId">
        </app-table>
    </div>
</div>